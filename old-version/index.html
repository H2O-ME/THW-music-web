<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="icon" type="image/webp" href="https://image.tianhw.top/avatar.webp">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THW music</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://s4.zstatic.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <script src="https://s4.zstatic.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="h-screen flex flex-col overflow-hidden select-none">

    <!-- Mobile Sidebar Backdrop -->
    <div id="sidebar-backdrop" class="fixed inset-0 bg-black/20 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-300 md:hidden"></div>

    <!-- Main Layout -->
    <div class="flex flex-1 h-[calc(100vh-80px)]">
        
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 flex flex-col bg-white/60 backdrop-blur-md border-r border-gray-200/60 shadow-[4px_0_24px_rgba(0,0,0,0.02)] pt-4 px-2 z-50 transition-all duration-300 relative">
            <div class="mb-6 px-2 flex items-center gap-3 h-10">
                <button id="sidebar-toggle" class="p-1.5 rounded-md hover:bg-gray-200 text-gray-800 transition-colors">
                    <i class="ri-menu-line text-xl"></i>
                </button>
                <div class="flex items-center gap-3 overflow-hidden whitespace-nowrap" id="logo-container">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white shrink-0">
                        <i class="ri-music-fill"></i>
                    </div>
                    <h1 id="logo-text" class="font-semibold text-lg tracking-tight sidebar-text text-gray-900">THW music</h1>
                </div>
            </div>

            <nav class="space-y-1 flex-1">
                <button id="nav-search" class="w-full flex items-center gap-3 px-3 py-2 rounded-md bg-white shadow-sm text-sm font-medium text-gray-900 transition-colors overflow-hidden whitespace-nowrap" title="首页">
                    <i class="ri-home-4-line text-lg shrink-0"></i>
                    <span class="sidebar-text">首页</span>
                </button>
                <button id="nav-playlists" class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-white/50 text-sm font-medium text-gray-800 hover:text-gray-900 transition-colors overflow-hidden whitespace-nowrap" title="歌单广场">
                    <i class="ri-play-list-fill text-lg shrink-0"></i>
                    <span class="sidebar-text">歌单广场</span>
                </button>
                <button id="nav-favorites" class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-white/50 text-sm font-medium text-gray-800 hover:text-gray-900 transition-colors overflow-hidden whitespace-nowrap" title="我的收藏">
                    <i class="ri-heart-line text-lg shrink-0"></i>
                    <span class="sidebar-text">我的收藏</span>
                </button>
            </nav>

            <div class="mt-auto mb-6">
                <!-- Settings removed -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 relative bg-white/50 mica-effect overflow-hidden flex flex-col">
            
            <!-- Search Header -->
            <div class="h-16 flex items-center justify-between px-4 md:px-8 border-b border-gray-100 bg-white/30 backdrop-blur-sm z-10">
                <div class="flex items-center w-full gap-3 md:ml-4">
                    <button id="mobile-menu-btn" class="md:hidden text-gray-600 p-2 -ml-2 rounded-md hover:bg-white/50 transition-colors">
                        <i class="ri-menu-line text-xl"></i>
                    </button>
                    <div class="relative w-full max-w-3xl mx-auto">
                        <i class="ri-search-line absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="search-input" 
                            class="w-full pl-12 pr-6 py-2.5 bg-white/60 hover:bg-white border-0 rounded-full text-base focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all shadow-sm"
                            placeholder="搜索歌曲、歌手...">
                        <!-- Search Suggestions -->
                        <div id="search-suggestions" class="absolute top-full left-0 right-0 mt-2 bg-white rounded-2xl shadow-xl border border-gray-100 hidden z-50 overflow-hidden animate-slide-down">
                            <!-- Suggestions injected here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div id="content-area" class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth relative">
                
                <!-- Welcome / Hot Search State -->
                <div id="welcome-state" class="min-h-full flex flex-col items-center pt-0 pb-20">
                    
                    <!-- Top Artists Section -->
                    <div id="top-artists-container" class="w-full max-w-6xl px-4 mb-8 hidden">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                            <i class="ri-user-star-fill text-blue-500"></i>
                            热门歌手
                        </h3>
                        <div id="top-artists-grid" class="flex overflow-x-auto gap-4 pb-4 scrollbar-hide snap-x">
                            <!-- Artist Cards will be injected here -->
                        </div>
                    </div>

                    <!-- Split Section: Hot Search & New Songs -->
                    <div class="w-full max-w-6xl px-4 grid grid-cols-1 lg:grid-cols-2 gap-8">
                        
                        <!-- Hot Search Section -->
                        <div id="hot-search-container" class="hidden">
                            <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                                <i class="ri-fire-fill text-red-500"></i>
                                热门搜索
                            </h3>
                            <div id="hot-search-grid" class="grid grid-cols-2 gap-4">
                                <!-- Cards will be injected here -->
                            </div>
                        </div>

                        <!-- New Songs Section -->
                        <div id="new-songs-container" class="hidden">
                            <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                                <i class="ri-disc-fill text-purple-500"></i>
                                新歌速递
                            </h3>
                            <div id="new-songs-grid" class="grid grid-cols-1 gap-3">
                                <!-- New Songs will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Playlist View -->
                <div id="playlist-view" class="hidden min-h-full flex flex-col items-center pt-0 pb-20">
                    <div class="w-full max-w-6xl px-4">
                        <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                            <i class="ri-play-list-fill text-blue-500"></i>
                            歌单广场
                        </h3>
                        <div id="playlist-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                            <!-- Playlists will be injected here -->
                        </div>
                    </div>
                </div>

                <!-- Playlist Detail View -->
                <div id="playlist-detail-view" class="hidden min-h-full flex flex-col pb-20">
                    <div class="w-full max-w-6xl mx-auto px-4">
                        <button id="back-to-playlists" class="mb-6 flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors">
                            <i class="ri-arrow-left-line"></i>
                            返回歌单广场
                        </button>
                        <div id="playlist-info" class="flex flex-col md:flex-row gap-8 mb-8">
                            <!-- Playlist Info injected here -->
                        </div>
                        <div id="playlist-tracks" class="flex flex-col gap-1">
                            <!-- Tracks injected here -->
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loading-state" class="hidden h-full flex items-center justify-center">
                    <div class="loader"></div>
                </div>

                <!-- Favorites Header -->
                <div id="favorites-header" class="hidden flex justify-between items-center px-4 py-4 max-w-6xl mx-auto w-full mb-2">
                    <h2 class="text-2xl font-bold text-gray-800">我的收藏</h2>
                    <button id="btn-import-playlist" class="flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-md border border-gray-200 text-gray-700 rounded-lg hover:bg-white hover:shadow-md hover:text-blue-600 transition-all shadow-sm pointer-events-auto text-sm font-medium group">
                        <i class="ri-download-cloud-2-line text-gray-500 group-hover:text-blue-600 transition-colors"></i>
                        <span>导入歌单</span>
                    </button>
                </div>

                <!-- Results Grid -->
                <div id="list-header" class="hidden grid grid-cols-[40px_1fr_50px] md:grid-cols-[50px_4fr_3fr_100px] gap-2 md:gap-4 px-2 md:px-4 py-2 text-xs text-gray-500 border-b border-gray-100 mb-2">
                    <div class="text-center">#</div>
                    <div>标题</div>
                    <div class="hidden md:block">歌手</div>
                    <div class="text-center">喜欢</div>
                </div>
                <div id="results-container" class="hidden flex flex-col gap-1 pb-20">
                    <!-- Song Rows will be injected here -->
                </div>

            </div>

            <!-- Lyric View Overlay -->
            <!-- Moved to body -->
        </main>
    </div>

    <!-- Lyric View Overlay -->
    <div id="lyric-view" class="fixed inset-0 z-[55] hidden flex flex-col items-center justify-center transition-all duration-500 opacity-0 bg-gray-900">
        
        <!-- Mobile Header -->
        <div class="absolute top-0 left-0 right-0 h-24 px-6 pt-8 flex items-start justify-between z-30 md:hidden bg-gradient-to-b from-black/40 to-transparent pointer-events-none">
            <button id="btn-close-lyric-mobile" class="p-2 -ml-2 rounded-full text-white/80 hover:text-white transition-colors pointer-events-auto">
                <i class="ri-arrow-down-s-line text-3xl"></i>
            </button>
            <div class="flex-1 text-center px-4 mt-1">
                <h2 id="mobile-lyric-title" class="text-lg font-bold text-white truncate drop-shadow-md"></h2>
                <p id="mobile-lyric-artist" class="text-xs text-white/60 font-medium truncate drop-shadow-sm"></p>
            </div>
            <div class="w-10"></div> <!-- Spacer for centering -->
        </div>

        <!-- Desktop Close Button -->
        <button id="btn-close-lyric" class="hidden md:block absolute top-6 left-6 z-20 p-2 rounded-full bg-white/10 hover:bg-white/20 text-white transition-colors backdrop-blur-md group">
            <i class="ri-arrow-down-s-line text-2xl group-hover:scale-110 transition-transform block"></i>
        </button>

        <!-- Dynamic Background -->
        <div id="lyric-bg" class="absolute inset-0 bg-cover bg-center transition-all duration-700 opacity-40 blur-[50px] scale-110 transform-gpu pointer-events-none will-change-transform"></div>
        <div class="absolute inset-0 bg-black/20 pointer-events-none"></div>

        <!-- Content Container -->
        <div class="relative z-10 w-full h-full flex flex-col md:flex-row items-center justify-center gap-0 md:gap-16 px-4 md:px-20 pt-24 pb-48 md:py-24">
            <!-- Left: Song Info (Desktop) -->
            <div class="hidden md:flex flex-col items-center w-1/3 max-w-sm shrink-0">
                <img id="lyric-cover" src="" class="w-80 h-80 rounded-2xl shadow-2xl mb-8 object-cover">
                <h2 id="lyric-title" class="text-3xl font-bold text-white text-center mb-2 px-4 leading-tight drop-shadow-md"></h2>
                <p id="lyric-artist" class="text-lg text-white/70 font-medium drop-shadow-sm"></p>
            </div>
            
            <!-- Right: Lyrics -->
            <div id="lyric-container" class="relative w-full md:w-1/2 h-full overflow-y-auto text-center space-y-8 px-4 mask-image-gradient no-scrollbar">
                <p class="text-white/40 italic mt-40">暂无歌词</p>
            </div>
        </div>

        <!-- Mobile Footer Controls -->
        <div class="absolute bottom-0 left-0 right-0 px-6 pb-8 pt-12 flex flex-col justify-end z-30 md:hidden bg-gradient-to-t from-black/60 via-black/30 to-transparent">
            <!-- Progress -->
            <div class="flex items-center gap-3 mb-6 text-xs text-white/60 font-medium font-mono">
                <span id="mobile-time-current">00:00</span>
                <div class="relative flex-1 h-1 bg-white/20 rounded-full group cursor-pointer">
                    <div id="mobile-progress-fill" class="absolute top-0 left-0 h-full bg-white rounded-full w-0"></div>
                    <div id="mobile-progress-handle" class="absolute top-1/2 -translate-y-1/2 -ml-1.5 w-3 h-3 bg-white rounded-full shadow-sm scale-100"></div>
                    <input type="range" id="mobile-progress-bar" value="0" min="0" max="100" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                </div>
                <span id="mobile-time-total">00:00</span>
            </div>

            <!-- Controls -->
            <div class="flex items-center justify-between px-2">
                <button class="text-white/60 hover:text-white p-2"><i class="ri-repeat-2-line text-xl"></i></button>
                <button id="btn-prev-mobile" class="text-white hover:text-white/80 p-2 active:scale-90 transition-transform"><i class="ri-skip-back-fill text-3xl"></i></button>
                <button id="btn-play-mobile" class="w-16 h-16 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-white backdrop-blur-md transition-all active:scale-95">
                    <i class="ri-play-fill text-4xl ml-1"></i>
                </button>
                <button id="btn-next-mobile" class="text-white hover:text-white/80 p-2 active:scale-90 transition-transform"><i class="ri-skip-forward-fill text-3xl"></i></button>
                <button class="text-white/60 hover:text-white p-2"><i class="ri-menu-line text-xl"></i></button>
            </div>
        </div>
    </div>

    <!-- Player Bar -->
    <div id="player-bar" class="h-20 bg-white/90 backdrop-blur-2xl border-t border-white/20 px-2 md:px-8 flex items-center justify-between z-[60] shadow-[0_-8px_30px_rgba(0,0,0,0.08)] transition-all duration-300 relative pb-[env(safe-area-inset-bottom)] box-content">
        
        <!-- Progress Bar (Netease Style) -->
        <div class="absolute top-0 left-0 right-0 h-0.5 group cursor-pointer z-50 hover:h-1 transition-all duration-200">
            <!-- Background -->
            <div id="progress-track" class="absolute inset-0 bg-gray-200/50 transition-colors duration-300"></div>
            <!-- Fill -->
            <div id="progress-fill" class="absolute top-0 left-0 h-full bg-blue-500 w-0 transition-all duration-100"></div>
            <!-- Handle -->
            <div id="progress-handle" class="absolute top-1/2 -translate-y-1/2 -ml-1.5 w-3 h-3 bg-blue-500 rounded-full opacity-0 group-hover:opacity-100 shadow-sm scale-0 group-hover:scale-100 transition-all"></div>
            <!-- Input -->
            <input type="range" id="progress-bar" value="0" min="0" max="100" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
        </div>

        <!-- Song Info -->
        <div class="flex items-center gap-3 md:gap-5 w-auto max-w-[45%] md:max-w-[25%] md:w-1/4 min-w-0 md:min-w-[240px]">
            <div class="w-12 h-12 md:w-14 md:h-14 shrink-0 bg-gray-100 rounded-xl overflow-hidden shadow-lg relative group cursor-pointer border border-gray-200/50" id="mini-cover-container">
                <img id="player-cover" crossorigin="anonymous" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="w-full h-full object-cover opacity-0 transition-opacity duration-300" alt="Cover">
                <div class="absolute inset-0 bg-black/20 hidden group-hover:flex items-center justify-center backdrop-blur-[2px] transition-all">
                    <i class="ri-arrow-up-s-line text-white text-xl"></i>
                </div>
                <!-- Placeholder Icon -->
                <div class="absolute inset-0 flex items-center justify-center text-gray-300 -z-10 bg-gray-50">
                    <i class="ri-music-2-fill text-2xl opacity-50"></i>
                </div>
            </div>
            <div class="flex flex-col overflow-hidden gap-0.5 min-w-0">
                <h3 id="player-title" class="font-bold text-base text-gray-900 truncate tracking-tight">未播放</h3>
                <div class="flex items-center gap-2">
                    <p id="player-artist" class="text-xs md:text-sm text-gray-500 truncate font-medium">-</p>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col items-center flex-1 max-w-xl gap-1 md:gap-2 justify-center min-w-0">
            <div class="mobile-controls-hidden md:flex items-center gap-3 md:gap-8">
                <button id="btn-prev" class="text-gray-400 hover:text-gray-900 transition-colors disabled:opacity-30 disabled:cursor-not-allowed hover:scale-110 active:scale-95 transform duration-200"><i class="ri-skip-back-fill text-xl md:text-2xl"></i></button>
                <button id="btn-play" class="text-gray-800 hover:text-blue-600 transition-colors disabled:opacity-30 disabled:cursor-not-allowed hover:scale-110 active:scale-95 transform duration-200 flex items-center justify-center">
                    <i class="ri-play-fill text-3xl md:text-4xl ml-1"></i>
                </button>
                <button id="btn-next" class="text-gray-400 hover:text-gray-900 transition-colors disabled:opacity-30 disabled:cursor-not-allowed hover:scale-110 active:scale-95 transform duration-200"><i class="ri-skip-forward-fill text-xl md:text-2xl"></i></button>
            </div>
            <!-- Mobile Mini Lyric -->
            <div id="mini-lyric" class="md:hidden text-xs text-blue-600/80 truncate w-full px-2 text-center font-medium h-5"></div>

            <!-- Hidden Time Elements for JS compatibility -->
            <span id="time-current" class="hidden">0:00</span>
            <span id="time-total" class="hidden">0:00</span>
        </div>

        <!-- Volume & Misc -->
        <div class="flex items-center justify-end gap-4 w-auto md:w-1/4 pl-2">
            <button id="btn-favorite" class="text-gray-400 hover:text-red-500 transition-colors p-2 rounded-full hover:bg-red-50" title="收藏">
                <i class="ri-heart-line text-xl"></i>
            </button>
            <button id="btn-pip" class="hidden md:block text-gray-400 hover:text-blue-600 transition-colors hover:bg-blue-50 p-2 rounded-lg" title="画中画歌词">
                <i class="ri-picture-in-picture-line text-lg"></i>
            </button>
            <button id="btn-lyrics" class="hidden md:block text-gray-400 hover:text-blue-600 transition-colors hover:bg-blue-50 p-2 rounded-lg" title="歌词"><i class="ri-chat-quote-line text-lg"></i></button>
        </div>
    </div>

    <!-- Import Playlist Modal -->
    <div id="import-modal" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-[80] hidden flex items-center justify-center opacity-0 transition-opacity duration-300">
        <div class="bg-white/90 backdrop-blur-xl border border-gray-200 rounded-2xl shadow-2xl w-full max-w-md p-6 transform transition-transform duration-300">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">导入网易云歌单</h3>
                <button id="btn-cancel-import" class="text-gray-400 hover:text-gray-600"><i class="ri-close-line text-2xl"></i></button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">歌单ID或链接</label>
                    <input type="text" id="import-playlist-id" class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500/20" placeholder="例如: 13701453917">
                    <p class="text-xs text-gray-500 mt-1">将自动搜索并收藏歌单中的歌曲</p>
                </div>

                <!-- Progress -->
                <div id="import-progress" class="hidden space-y-2">
                    <div class="flex justify-between text-xs text-gray-600">
                        <span>导入进度</span>
                        <span id="import-progress-text">0/0</span>
                    </div>
                    <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                        <div id="import-progress-bar" class="h-full bg-blue-600 transition-all duration-300 w-0"></div>
                    </div>
                    <div id="import-log" class="h-24 overflow-y-auto bg-gray-50 rounded p-2 text-xs font-mono border border-gray-100"></div>
                </div>

                <button id="btn-confirm-import" class="w-full py-2.5 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors shadow-lg shadow-blue-600/20">
                    开始导入
                </button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-[80] hidden flex items-center justify-center opacity-0 transition-opacity duration-300">
        <div class="bg-white/90 backdrop-blur-xl border border-gray-200 rounded-2xl shadow-2xl w-full max-w-sm p-8 transform scale-95 transition-transform duration-300" id="login-panel">
            <div class="text-center mb-8">
                <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white mx-auto mb-4 shadow-lg shadow-blue-600/30">
                    <i class="ri-music-fill text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">欢迎回来</h2>
                <p class="text-gray-500 text-sm mt-2">请登录/注册以使用收藏功能</p>
            </div>
            
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1.5">用户名</label>
                    <input type="text" id="login-username" required class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-base focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all" placeholder="请输入用户名">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1.5">密码</label>
                    <input type="password" id="login-password" required class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-base focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all" placeholder="请输入密码">
                </div>
                <button type="submit" class="w-full py-2.5 bg-blue-600 text-white font-semibold rounded-lg shadow-lg shadow-blue-600/30 hover:bg-blue-500 hover:shadow-blue-500/40 active:scale-95 transition-all mt-4">
                    登录 / 注册
                </button>
            </form>
        </div>
    </div>

    <!-- Settings Modal Removed -->

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-24 right-6 z-[60] flex flex-col gap-2 pointer-events-none"></div>

    <!-- Hidden Audio Element -->
    <audio id="audio-player"></audio>

    <script type="module" src="js/main.js"></script>
</body>
</html>
